{% extends 'base.html' %}
{% load static %}

{% block title %}MapQuest Mode{% endblock title %}

{% block body %}
<div class="container mt-5 text-center">
    <h2>MapQuest Mode - {{ question.get_question_type_display }}</h2>
    <div class="p-4 bg-light rounded mt-4">
        <h3>{{ question.question_text }}</h3>
        {% if question.image %}
            <img src="{{ question.image.url }}" alt="map" class="img-fluid mb-4 rounded shadow" style="max-height:300px;">
        {% endif %}
        <form id="mapQuestForm" method="post">
            {% csrf_token %}
            <input type="hidden" name="question_id" value="{{ question.pk }}">
            <div class="list-group mt-3">
                {% for choice in choices %}
                    <button type="button" class="list-group-item list-group-item-action choice-btn">{{ choice }}</button>
                {% endfor %}
            </div>
            <input type="hidden" name="selected_answer" id="selected_answer" value="">
            <button type="submit" class="btn btn-primary mt-3" disabled id="submitBtn">Submit</button>
        </form>
        <div id="result" class="mt-3"></div>
    </div>
</div>
{% endblock body %}

{% block scriptsrc %}
<script>
    let selectedAnswerInput = document.getElementById('selected_answer');
    let submitBtn = document.getElementById('submitBtn');
    document.querySelectorAll('.choice-btn').forEach(btn => {
        btn.onclick = function() {
            selectedAnswerInput.value = this.textContent.trim();
            submitBtn.disabled = false;
            document.querySelectorAll('.choice-btn').forEach(b => b.classList.remove('active', 'bg-primary', 'text-white'));
            this.classList.add('active', 'bg-primary', 'text-white');
        }
    });

    document.getElementById('mapQuestForm').onsubmit = function(e) {
        e.preventDefault();
        if (!selectedAnswerInput.value) {
            alert("Please select an answer before submitting!");
            return;
        }
        let formData = new FormData(this);
        fetch(window.location.href, {
            method: 'POST',
            body: formData
        }).then(res => res.json()).then(data => {
            if (data.is_correct) {
                document.getElementById('result').innerHTML = `<span style="color:green">Correct! +75 points</span>`;
            } else {
                document.getElementById('result').innerHTML = `<span style="color:red">Wrong! Try again.</span>`;
            }
        });
    };
</script>
{% endblock scriptsrc %}
